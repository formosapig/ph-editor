<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>比較角色</title>
  <script src="[[ url_for('static', filename='petite-vue.iife.js') ]]" defer></script>
  <link rel="stylesheet" href="[[ url_for('static', filename='compare.css') ]]" />
  <script>
    window.rawCompareData = {
      characters: [[ characters | tojson ]],
      attributes: [[ attributes | tojson ]],
      attrNameMap: [[ attribute_name_map | tojson ]],
      attrBlockMap: [[ attribute_block_map | tojson ]],
    };
  </script>
</head>
<body>

<!-- 修改：新增控制區 -->
<div class="page-wrapper" v-scope v-cloak>
<div class="controls">
  <label><input type="checkbox" v-model="visibleBlocks" value="hair">髮型</label>
  <label><input type="checkbox" v-model="visibleBlocks" value="face">臉龐</label>
  <label><input type="checkbox" v-model="visibleBlocks" value="body">身體</label>
  <label><input type="checkbox" v-model="visibleBlocks" value="clothing">服裝</label>
  <label><input type="checkbox" v-model="visibleBlocks" value="accessory">配飾</label>
  <button @click="reloadData">Reload 全部資料</button>
</div>
<!-- 修改結束 -->

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th class="corner-cell">屬性</th>
        <th v-for="char in characters" :key="char.file_id"
            class="file-id-col">
          <a :href="`/edit?file_id=${encodeURIComponent(char.file_id)}`"
             :target="`edit_file_${char.file_id}`"
             @click.prevent="openEditWindow(char.file_id)"
             class="file-id-link-content">
            <img :src="`/cache/thumb_${char.file_id}.jpg`"
                 class="file-id-thumbnail" alt="角色縮圖" draggable="false">
            <!--<span class="truncated-file-id">{{ truncateFileId(char.file_id) }}</span>-->
			<span class="file-id-text">
              <span class="file-id-name">{{ truncateFileId(char.file_id) }}</span><br>
              <span class="file-id-note"> 測試用 remark </span>
            </span>
          </a>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="attr in displayAttributes" :key="attr"
          v-show="attrBlockMap[attr] === 'basic' || visibleBlocks.includes(attrBlockMap[attr])">
        <td class="attr-name-col" :class="getAttributeBlockClass(attr)">
          {{ attrNameMap[attr] || attr }}
        </td>
        <td v-for="(char, index) in characters"
            :key="char.file_id"
            :class="[
			  getAttributeBlockClass(attr),
			  { 'text-different': index > 0 && isDifferentFromFirst(index, attr) },
			  { 'notes-cell': attr === 'notes' } // 檢查屬性是否為 'notes'
			]">
          <div class="content-container" v-html="generateColorHtml(char[attr])"></div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

</div>

<script src="[[ url_for('static', filename='compare.js') ]]" defer></script>
</body>
</html>
