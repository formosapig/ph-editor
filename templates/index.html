<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>PH editor</title>
  <link rel="stylesheet" href="[[ url_for('static', filename='style.css') ]]" />
  <link rel="stylesheet" href="[[ url_for('static', filename='app.css') ]]" />
  <script src="[[ url_for('static', filename='petite-vue.iife.js') ]]" defer></script>
</head>
<body>
  <div v-scope v-cloak>
    <div v-effect="onMounted()"></div>
    <div id="actionButtons" class="action-bar">
      <div class="buttons-row">
        <div class="left-buttons">
          <button @click="changeFolder" title="ä¿®æ”¹æƒæè³‡æ–™å¤¾" :disabled="isAnyMenuOpen">ğŸ“</button>
		      <button @click="toggleSort" ref="sortButton" :class="{ active: showSortMenu }" title="æ’åº">ğŸ”ƒ</button>
		      <button @click="toggleFilter" :class="{ active: showFilterMenu }" title="ç¯©é¸">ğŸ”</button>
          <button @click="compareSelected" :disabled="selectedCount < 2 || isAnyMenuOpen" title="æ¯”è¼ƒ">ğŸ“Šï¸</button>
          <button @click="arrangeSelected" :disabled="selectedCount < 2 || isAnyMenuOpen" title="æ’åˆ—">ğŸ“‹ï¸</button>		  
          <button @click="editSelected" :disabled="selectedCount !== 1 || isAnyMenuOpen" title="ç·¨è¼¯">âœï¸</button>
          <button @click="renameSelected" :disabled="selectedCount !== 1 || isAnyMenuOpen" title="æ”¹å">ğŸ…°ï¸</button>
          <button @click="copySelected" :disabled="selectedCount !== 1 || isAnyMenuOpen" title="è¤‡è£½">ğŸ’¾</button>
          <button @click="deleteSelected" :disabled="selectedCount === 0 || isAnyMenuOpen" title="åˆªé™¤">ğŸ—‘ï¸</button>
        </div>
		    <div class="center-status-toggle">
          <label class="status-btn" :class="{ active: activeStatuses.includes('archived') }">
            <input type="checkbox" v-model="activeStatuses" value="archived" @change="toggleStatus" hidden> ğŸ“¦å°å­˜
          </label>
          <label class="status-btn" :class="{ active: activeStatuses.includes('draft') }">
            <input type="checkbox" v-model="activeStatuses" value="draft" @change="toggleStatus" hidden> ğŸ§©è‰ç¨¿
          </label>
          <label class="status-btn" :class="{ active: activeStatuses.includes('refinement') }">
            <input type="checkbox" v-model="activeStatuses" value="refinement" @change="toggleStatus" hidden> ğŸ¨æ½¤é£¾
          </label>
          <label class="status-btn" :class="{ active: activeStatuses.includes('finalized') }">
            <input type="checkbox" v-model="activeStatuses" value="finalized" @change="toggleStatus" hidden> ğŸ“Œå®šç¨¿
          </label>
        </div>
        <div class="right-button">
		      <button @click="openGeneral" :disabled="!currentScanPath" title="å…¨åŸŸ">ğŸ“š</button>
          <button @click="openCCM" :disabled="!currentScanPath" title="æ™‚ç©ºå› æœ">ğŸŒŒï¸</button>
          <button @click="openEpoch" :disabled="!currentScanPath" title="æ­²æœˆ">â³</button>
          <button @click="openWishing" :disabled="!currentScanPath" title="è¨±é¡˜å™´æ³‰">â›²</button>
        </div>
      </div>
      <div class="status-bar">
        <span>ğŸ“‚ æƒæè·¯å¾‘ï¼š{{ scanPathDisplay }}</span>
        <span>é¸æ“‡: {{ selectedCount }} / ç¸½æ•¸: {{ totalFilesCount }}</span>
      </div>
    </div>

    <div id="gallery" class="clickable-area" @click="handleGalleryClick">
      <div v-for="item in displayedImages" 
           :key="`${item.id}-${sortAscending}`"
           class="thumb-container"
           :class="{ selected: isSelected(item.id) }"
           @click="toggleSelect(item.id, $event)">
        <div class="checkmark">âœ…</div>
        <div class="thumb-wrapper">
          <img :src="'/cache/' + item.thumb" 
               class="thumb" 
               :alt="item.id" 
               width="252" 
               height="352" 
               draggable="false">
          <div v-if="item.profile_name" class="profile-badge">{{ item.profile_name }}</div>
          <div v-if="item.tag_name" 
               class="tag-label"
               :style="getTagStyle(item.tag_style)">
            {{ item.tag_name }}
          </div>
		  <div v-if="item.scenario_title" class="scenario-badge">{{ item.scenario_title }}</div>
        </div>
		<div>
          <div class="filename-label">
		    <span v-if="item.status === 'archived'" title="å°å­˜">ğŸ“¦</span>
		    <span v-if="item.status === 'draft'" title="è‰ç¨¿">ğŸ§©</span>
            <span v-if="item.status === 'refinement'" title="æ½¤é£¾">ğŸ¨</span>
            <span v-if="item.status === 'finalized'" title="å®šç¨¿">ğŸ“Œ</span>
			{{ item.id }}
          </div>
		  <div v-if="item.remark" class="file-id-remark">{{ item.remark }}</div>
		</div>
      </div>
    </div>

	<!-- æ’åºé¸å–® -->
    <div v-if="showSortMenu" id="sortMenu" class="float-menu horizontal" @click.stop>
      <div class="option" :class="{ active: sortKey === 'id' }" @click="applySort('id')">ğŸ“„ æª”å</div>
      <div class="option" :class="{ active: sortKey === 'profile_name' }" @click="applySort('profile_name')">ğŸ‘¤ äººå</div>
      <div class="option" :class="{ active: sortKey === 'scenario_title' }" @click="applySort('scenario_title')">ğŸ¬ å ´æ™¯</div>	  
      <div class="option" :class="{ active: sortKey === 'tag_name' }" @click="applySort('tag_name')">ğŸ·ï¸ æ¨™ç±¤</div>
      <div class="divider"></div>
      <div class="option" @click="toggleSortOrder">{{ sortAscending ? 'â¬†ï¸ æ˜‡åº' : 'â¬‡ï¸ é™åº' }}</div>
    </div>

    <!-- ç¯©é¸é¸å–® -->
    <div v-if="showFilterMenu" class="float-menu horizontal" @click.stop>
      <div class="option" :class="{ active: filterKey === 'id' }" @click="applyFilter('id')">ğŸ“„ æª”å</div>
      <div class="option" :class="{ active: filterKey === 'profile_name' }" @click="applyFilter('profile_name')">ğŸ‘¤ äººå</div>
      <div class="option" :class="{ active: filterKey === 'scenario_title' }" @click="applyFilter('scenario_title')">ğŸ¬ å ´æ™¯</div>
      <div class="option" :class="{ active: filterKey === 'tag_name' }" @click="applyFilter('tag_name')">ğŸ·ï¸ æ¨™ç±¤</div>
      <div class="option" :class="{ active: filterKey === '' }" @click="applyFilter('')">ğŸ§¹ æ¸…é™¤</div>
	  <div class="divider"></div>
      <input type="text" v-model="filterKeyword" placeholder="è¼¸å…¥é—œéµå­—..." />
    </div>
	
    <div v-if="showWishing" class="wish-fountain">
      <div class="wish-list">
        <div v-for="w in wishes" :key="w.id" class="wish-item">
          <div class="wish-header">
            <span>{{ w.type }} {{ w.date }}</span>
            <span class="delete-btn" @click="deleteWish(w.id)">âœ•</span>
          </div>
          <div class="wish-content">{{ w.content }}</div>
        </div>
      </div>

      <div class="wish-input-area">
        <select v-model="newWishType" style="width: 100%; margin-bottom: 5px;">
          <option value="ğŸ“•">ğŸ“• éŒ¯èª¤</option>
          <option value="ğŸ“—">ğŸ“— å„ªåŒ–</option>
          <option value="ğŸ“˜">ğŸ“˜ é‡æ§‹</option>
          <option value="ğŸ“™">ğŸ“™ åŠŸèƒ½</option>
        </select>
        <textarea v-model="newWishContent" placeholder="éš¨æ‰‹è¨˜ä¸‹æƒ³æ³•..." 
                    style="width: 100%; height: 60px; resize: none;"></textarea>
        <button @click="submitWish" style="width: 100%; margin-top: 5px; cursor: pointer;">
          æŠ•é€²å™´æ³‰ â›²
        </button>
      </div>
    </div>
  
  </div>

  <script src="[[ url_for('static', filename='app.js') ]]"></script>
</body>
</html>